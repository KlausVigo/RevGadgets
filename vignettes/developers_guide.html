<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Carrie Tribble and Mike May" />

<meta name="date" content="2019-04-29" />

<title>RevGadgets Developers’ Guide</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">RevGadgets Developers’ Guide</h1>
<h4 class="author">Carrie Tribble and Mike May</h4>
<h4 class="date">2019-04-29</h4>



<div id="intro" class="section level2">
<h2>Intro</h2>
<p>The purpose of this vignette is to establish common practices for functions that will be included in RevGadgets. These practices include documenting, writing, and testing of functions.</p>
<p>We will use the following example functions to illustrate these best practices:</p>
<div id="example-1-processdivrates" class="section level3">
<h3>Example 1: processDivRates()</h3>
<p>This function processes the output of the episodic birth-death process tutorial from RevBayes, making the data available for subsequent plotting. It relies on the function readTrace(). If you are curious about that function, please see the corresponding documentation in the R package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="co">#' Process Diversification Rates</span>
<span class="co">#'</span>
<span class="co">#'</span>
<span class="co">#' Processing the output of a episodic diversification rate analysis with mass-extinction events.</span>
<span class="co">#'</span>
<span class="co">#' For processing the output of an episodic diversiation rate analysis. processDivRates()</span>
<span class="co">#' assumes that the epochs are fixed rather than inferred. Additionally, it assumes</span>
<span class="co">#' that times correspond to rates such that the first rate parameter (i.e. speciation[1])</span>
<span class="co">#' corresponds to the present. Conversely, the first time parameter</span>
<span class="co">#' (i.e. interval_times[1]) corresponds to the first time interval after the present,</span>
<span class="co">#' moving backwards in time. processDivRates() relies on readTrace and produces a list</span>
<span class="co">#' object that can be read by plotDivRates() to vizualize the results. For now,</span>
<span class="co">#' only one log file per parameter type is accepted (i.e. log files from multiple runs</span>
<span class="co">#' must be combined before reading into the function).</span>
<span class="co">#'</span>
<span class="co">#'@param speciation_time_log (vector of character strings or single character string; &quot;&quot;) Path to speciation times log file(s)</span>
<span class="co">#'@param speciation_rate_log (vector of character strings or single character string; &quot;&quot;) Path to speciation rates log file(s)</span>
<span class="co">#'@param extinction_time_log (vector of character strings or single character string; &quot;&quot;) Path to extinction times log file(s)</span>
<span class="co">#'@param extinction_rate_log (vector of character strings or single character string; &quot;&quot;) Path to extinction rates log file(s)</span>
<span class="co">#'</span>
<span class="co">#'@return List object with processed rate and time parameters.</span>
<span class="co">#'</span>
<span class="co">#'@examples</span>
<span class="co">#'</span>
<span class="co">#'primates &lt;- processDivRates(speciation_time_log = &quot;data/epi_bd/primates_EBD_speciation_times.log&quot;,</span>
<span class="co">#'                            speciation_rate_log = &quot;data/epi_bd/primates_EBD_speciation_rates.log&quot;,</span>
<span class="co">#'                            extinction_time_log = &quot;data/epi_bd/primates_EBD_extinction_times.log&quot;,</span>
<span class="co">#'                            extinction_rate_log = &quot;data/epi_bd/primates_EBD_extinction_rates.log&quot;,</span>
<span class="co">#'                            burnin = 0.25)</span>

processDivRates &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">speciation_time_log =</span> <span class="st">&quot;&quot;</span>,
                            <span class="dt">speciation_rate_log =</span> <span class="st">&quot;&quot;</span>,
                            <span class="dt">extinction_time_log =</span> <span class="st">&quot;&quot;</span>,
                            <span class="dt">extinction_rate_log =</span> <span class="st">&quot;&quot;</span>,
                            <span class="dt">burnin =</span> <span class="fl">0.25</span>) {

  <span class="co"># enforce argument matching</span>

  <span class="cf">if</span> (<span class="kw">is.character</span>(speciation_time_log) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="kw">stop</span>(<span class="st">&quot;speciation_time_log must be a single character string&quot;</span>)
  <span class="cf">if</span> (<span class="kw">is.character</span>(speciation_rate_log) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="kw">stop</span>(<span class="st">&quot;speciation_rate_log must be a single character string&quot;</span>)
  <span class="cf">if</span> (<span class="kw">is.character</span>(extinction_time_log) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="kw">stop</span>(<span class="st">&quot;extinction_time_log must be a single character string&quot;</span>)
  <span class="cf">if</span> (<span class="kw">is.character</span>(extinction_rate_log) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="kw">stop</span>(<span class="st">&quot;extinction_rate_log must be a single character string&quot;</span>)

  <span class="co"># check if speciation times log file(s) exist</span>
  do_speciation_time_log_exist &lt;-<span class="st"> </span><span class="kw">file.exists</span>(speciation_time_log)
  <span class="cf">if</span> ( <span class="kw">any</span>(do_speciation_time_log_exist <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span> ) {
    <span class="co"># print out paths to files that don't exist</span>
    <span class="kw">cat</span>( <span class="st">&quot;Some speciation_time_log files do not exist:&quot;</span>,
         <span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>,speciation_time_log[do_speciation_time_log_exist <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>]), <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
    <span class="kw">stop</span>()
  }

  <span class="co"># check if speciation rates log file(s) exist</span>
  do_speciation_rate_log_exist &lt;-<span class="st"> </span><span class="kw">file.exists</span>(speciation_rate_log)
  <span class="cf">if</span> ( <span class="kw">any</span>(do_speciation_rate_log_exist <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span> ) {
    <span class="co"># print out paths to files that don't exist</span>
    <span class="kw">cat</span>( <span class="st">&quot;Some speciation_rate_log files do not exist:&quot;</span>,
         <span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>,speciation_rate_log[do_speciation_rate_log_exist <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>]), <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
    <span class="kw">stop</span>()
  }

  <span class="co"># check if extinction times log file(s) exist</span>
  do_extinction_time_log_exist &lt;-<span class="st"> </span><span class="kw">file.exists</span>(extinction_time_log)
  <span class="cf">if</span> ( <span class="kw">any</span>(do_extinction_time_log_exist <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span> ) {
    <span class="co"># print out paths to files that don't exist</span>
    <span class="kw">cat</span>( <span class="st">&quot;Some extinction_time_log files do not exist:&quot;</span>,
         <span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>,extinction_time_log[do_extinction_time_log_exist <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>]), <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
    <span class="kw">stop</span>()
  }

  <span class="co"># check if extinction rates log file(s) exist</span>
  do_extinction_rate_log_exist &lt;-<span class="st"> </span><span class="kw">file.exists</span>(extinction_rate_log)
  <span class="cf">if</span> ( <span class="kw">any</span>(do_extinction_rate_log_exist <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span> ) {
    <span class="co"># print out paths to files that don't exist</span>
    <span class="kw">cat</span>( <span class="st">&quot;Some extinction_rate_log files do not exist:&quot;</span>,
         <span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>,extinction_rate_log[do_extinction_rate_log_exist <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>]), <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
    <span class="kw">stop</span>()
  }

  <span class="co"># read in log files as lists of data.frames with readTrace()</span>
  speciation_time &lt;-<span class="st"> </span><span class="kw">readTrace</span>(<span class="dt">path =</span> speciation_time_log,
                                <span class="dt">burnin =</span> burnin)
  speciation_rate &lt;-<span class="st"> </span><span class="kw">readTrace</span>(<span class="dt">path =</span> speciation_rate_log,
                                <span class="dt">burnin =</span> burnin)
  extinction_time &lt;-<span class="st"> </span><span class="kw">readTrace</span>(<span class="dt">path =</span> extinction_time_log,
                                <span class="dt">burnin =</span> burnin)
  extinction_rate &lt;-<span class="st"> </span><span class="kw">readTrace</span>(<span class="dt">path =</span> extinction_rate_log,
                                <span class="dt">burnin =</span> burnin)

  <span class="co"># check if all parameter types have the same number of log files</span>
  trace_lengths_same &lt;-<span class="st"> </span><span class="kw">identical</span>(<span class="kw">length</span>(speciation_time),
                                  <span class="kw">length</span>(speciation_rate),
                                  <span class="kw">length</span>(extinction_time),
                                  <span class="kw">length</span>(extinction_rate))

  <span class="cf">if</span> (trace_lengths_same <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) {
    <span class="kw">stop</span>(<span class="st">&quot;You must provide the same number of log files for each parameter type.&quot;</span>)}
  <span class="cf">else</span> <span class="cf">if</span> (trace_lengths_same <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) {
    <span class="cf">if</span> (<span class="kw">length</span>(speciation_time) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {
      <span class="kw">stop</span>(<span class="st">&quot;You must provide at least one log file per parameter type.&quot;</span>)
    } <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">length</span>(speciation_time) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) {
      <span class="kw">stop</span>(<span class="st">&quot;Currently, only one log file per parameter type is supported.&quot;</span>)
    } <span class="cf">else</span> <span class="cf">if</span> (<span class="kw">length</span>(speciation_time) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) {

      <span class="co"># convert single item lists to data frames</span>
      speciation_time &lt;-<span class="st"> </span>speciation_time[[<span class="dv">1</span>]]
      speciation_rate &lt;-<span class="st"> </span>speciation_rate[[<span class="dv">1</span>]]
      extinction_time &lt;-<span class="st"> </span>extinction_time[[<span class="dv">1</span>]]
      extinction_rate &lt;-<span class="st"> </span>extinction_rate[[<span class="dv">1</span>]]

      <span class="co"># add in dummy distribution of 0 for time in the present</span>
      speciation_time<span class="op">$</span><span class="st">`</span><span class="dt">interval_times[0]</span><span class="st">`</span> &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, <span class="kw">nrow</span>(speciation_time))
      extinction_time<span class="op">$</span><span class="st">`</span><span class="dt">interval_times[0]</span><span class="st">`</span> &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, <span class="kw">nrow</span>(extinction_time))

      <span class="co"># Calculate the net-diversification and relative-extinction rates</span>
      net_diversification_rate &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(speciation_rate[,<span class="dv">5</span><span class="op">:</span><span class="kw">ncol</span>(speciation_rate)]) <span class="op">-</span>
<span class="st">                                   </span><span class="kw">as.matrix</span>(extinction_rate[,<span class="dv">5</span><span class="op">:</span><span class="kw">ncol</span>(extinction_rate)])

      <span class="kw">colnames</span>(net_diversification_rate) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="kw">rep</span>(<span class="st">&quot;net_div&quot;</span>, <span class="dt">times =</span> <span class="kw">ncol</span>(net_diversification_rate)),
                                                   <span class="kw">rep</span>(<span class="st">&quot;[&quot;</span>, <span class="dt">times =</span> <span class="kw">ncol</span>(net_diversification_rate)),
                                                   <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(net_diversification_rate),
                                                   <span class="kw">rep</span>(<span class="st">&quot;]&quot;</span>, <span class="dt">times =</span> <span class="kw">ncol</span>(net_diversification_rate)), <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)

      relative_extinction_rate &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(extinction_rate[,<span class="dv">5</span><span class="op">:</span><span class="kw">ncol</span>(extinction_rate)]) <span class="op">/</span>
<span class="st">                                   </span><span class="kw">as.matrix</span>(speciation_rate[,<span class="dv">5</span><span class="op">:</span><span class="kw">ncol</span>(speciation_rate)])

      <span class="kw">colnames</span>(relative_extinction_rate) &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="kw">rep</span>(<span class="st">&quot;rel_ext&quot;</span>, <span class="dt">times =</span> <span class="kw">ncol</span>(relative_extinction_rate)),
                                                   <span class="kw">rep</span>(<span class="st">&quot;[&quot;</span>, <span class="dt">times =</span> <span class="kw">ncol</span>(relative_extinction_rate)),
                                                   <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(relative_extinction_rate),
                                                   <span class="kw">rep</span>(<span class="st">&quot;]&quot;</span>, <span class="dt">times =</span> <span class="kw">ncol</span>(relative_extinction_rate)), <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)

        <span class="co"># return a list of processed data frames</span>
        res &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;speciation rate&quot;</span> =<span class="st"> </span>speciation_rate,
                    <span class="st">&quot;extinction rate&quot;</span> =<span class="st"> </span>extinction_rate,
                    <span class="st">&quot;net-diversification rate&quot;</span> =<span class="st"> </span>net_diversification_rate,
                    <span class="st">&quot;relative-extinction rate&quot;</span> =<span class="st"> </span>relative_extinction_rate,
                    <span class="st">&quot;speciation time&quot;</span> =<span class="st"> </span>speciation_time,
                    <span class="st">&quot;extinction time&quot;</span> =<span class="st"> </span>extinction_time)
        <span class="kw">return</span>(res)
    }
  }
}</code></pre></div>
</div>
<div id="example-2-plotdivrates" class="section level3">
<h3>Example 2: plotDivRates()</h3>
<p>This function plots the results of the episodic birth-death process tutorial, taking as input the processed rates produced by processDivRates() above. We will mostly refer to this plotDivRates() function for this vignette.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#' Plot Diversification Rates</span>
<span class="co">#'</span>
<span class="co">#' Plots the output of a episodic diversification rate analysis</span>
<span class="co">#'</span>
<span class="co">#' Plots the output of diversification rate analyses. Takes as input the</span>
<span class="co">#' output of processDivRates() and plotting parameters. Does not return an</span>
<span class="co">#' object. For now, valid figure types include: &quot;speciation rate&quot;,</span>
<span class="co">#' &quot;extinction rate&quot;,&quot;net-diversification rate&quot;, and &quot;relative-extinction rate&quot;.</span>
<span class="co">#' If colors are not provided (parameter col), the plot defaults to preset colors.</span>
<span class="co">#'</span>
<span class="co">#'</span>
<span class="co">#' @param output (list; no default) The processed output for plotting (output of processDivRates()).</span>
<span class="co">#' @param fig_types (character vector, c(&quot;speciation rate&quot;, &quot;extinction rate&quot;, &quot;net-diversification rate&quot;, &quot;relative-extinction rate&quot;)) Which aspects of the model to visualize. See details for a complete description.</span>
<span class="co">#' @param xlab (character; &quot;million years ago&quot;) The label of the x-axis.</span>
<span class="co">#' @param col (character; NULL) Colors used for printing in hex code. Must be of same length as fig_types.</span>
<span class="co">#' @param col_alpha (character; &quot;50&quot;) Alpha channel parameter for credible intervals plotting. May range from 00 (completely transparent) to FF (completely opaque).</span>
<span class="co">#' @param offset (numeric; 0) Value to offset the x-axis by.</span>
<span class="co">#' @param xaxt (character; &quot;n&quot;) The type of x-axis to plot. By default, no x-axis is plotted (recommended).</span>
<span class="co">#' @param yaxt (character; &quot;s&quot;) The type of y-axis to plot.</span>
<span class="co">#' @param ... Parameters delegated to various plotting functions.</span>
<span class="co">#'</span>
<span class="co">#' @return Plots diversification rates, does not return an object.</span>
<span class="co">#'</span>
<span class="co">#' @examples</span>
<span class="co">#' # first run processDivRates()</span>
<span class="co">#' primates &lt;- processDivRates(speciation_time_log = &quot;data/epi_bd/primates_EBD_speciation_times.log&quot;,</span>
<span class="co">#'                             speciation_rate_log = &quot;data/epi_bd/primates_EBD_speciation_rates.log&quot;,</span>
<span class="co">#'                             extinction_time_log = &quot;data/epi_bd/primates_EBD_extinction_times.log&quot;,</span>
<span class="co">#'                             extinction_rate_log = &quot;data/epi_bd/primates_EBD_extinction_rates.log&quot;,</span>
<span class="co">#'                             burnin = 0.25)</span>
<span class="co">#' # then plot results:</span>
<span class="co">#' plotDivRates(output = primates)</span>


plotDivRates &lt;-<span class="st"> </span><span class="cf">function</span>(output,
                         <span class="dt">fig_types =</span> <span class="kw">c</span>(<span class="st">&quot;speciation rate&quot;</span>,
                                       <span class="st">&quot;extinction rate&quot;</span>,
                                       <span class="st">&quot;net-diversification rate&quot;</span>,
                                       <span class="st">&quot;relative-extinction rate&quot;</span>),
                         <span class="dt">xlab =</span> <span class="st">&quot;million years ago&quot;</span>,
                         <span class="dt">col =</span> <span class="ot">NULL</span>,
                         <span class="dt">col_alpha =</span> <span class="st">&quot;50&quot;</span>,
                         <span class="dt">offset =</span> <span class="dv">0</span>,
                         <span class="dt">xaxt =</span> <span class="st">&quot;n&quot;</span>,
                         <span class="dt">yaxt =</span> <span class="st">&quot;s&quot;</span>,
                         ...){
  <span class="co"># Enforce argument matching</span>
  <span class="cf">if</span> (<span class="kw">is.list</span>(output) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="kw">stop</span>(<span class="st">&quot;output must be list of processed rates&quot;</span>)
  <span class="cf">if</span> (<span class="kw">is.character</span>(fig_types) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="kw">stop</span>(<span class="st">&quot;fig_types must be a character string or vector of strings&quot;</span>)
  <span class="cf">if</span> (<span class="kw">is.character</span>(xlab) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="kw">stop</span>(<span class="st">&quot;xlab must be a single character string&quot;</span>)

  <span class="co"># check length of color vector and ensure colors are formatted as hex codes</span>
  <span class="cf">if</span> (<span class="kw">is.null</span>(col) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) {
    <span class="cf">if</span> (<span class="kw">length</span>(col) <span class="op">!=</span><span class="st"> </span><span class="kw">length</span>(fig_types))
      <span class="kw">stop</span>(<span class="st">&quot;col and fig_types must be of the same length&quot;</span>)
    bad_cols &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;FALSE&quot;</span>, <span class="dt">times =</span> <span class="kw">length</span>(col))
    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(col)) {
      col_split &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(col[i], <span class="dt">split =</span> <span class="st">&quot;&quot;</span>))
      <span class="cf">if</span> (<span class="kw">length</span>(col_split) <span class="op">!=</span><span class="st"> </span><span class="dv">7</span> <span class="op">|</span><span class="st"> </span>col_split[<span class="dv">1</span>] <span class="op">!=</span><span class="st"> &quot;#&quot;</span>) {
        bad_cols[i] &lt;-<span class="st"> </span><span class="ot">TRUE</span>
      }
    }
    <span class="cf">if</span> ( <span class="kw">any</span>(bad_cols <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span> ) {
      <span class="co"># print out colors that are 'bad'</span>
      <span class="kw">cat</span>( <span class="st">&quot;Some colors are not properly formatted hex codes:&quot;</span>,
           <span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>,col[bad_cols <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>]), <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
      <span class="kw">stop</span>()
    }
  }

  <span class="cf">if</span> (<span class="kw">is.character</span>(col_alpha) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="kw">stop</span>(<span class="st">&quot;col_alpha must be a character string&quot;</span>)
  <span class="cf">if</span> (<span class="kw">is.numeric</span>(offset) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="kw">stop</span>(<span class="st">&quot;offset must be a numeric value&quot;</span>)
  xaxt &lt;-<span class="st"> </span><span class="kw">match.arg</span>(xaxt, <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;n&quot;</span>, <span class="st">&quot;s&quot;</span>))
  yaxt &lt;-<span class="st"> </span><span class="kw">match.arg</span>(yaxt, <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;n&quot;</span>, <span class="st">&quot;s&quot;</span>))


  <span class="co"># Check that fig type is valid</span>
  valid_fig_types &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;speciation rate&quot;</span>,
                       <span class="st">&quot;extinction rate&quot;</span>,
                       <span class="st">&quot;net-diversification rate&quot;</span>,
                       <span class="st">&quot;relative-extinction rate&quot;</span>)

  invalid_fig_types &lt;-<span class="st"> </span>fig_types[<span class="op">!</span>fig_types <span class="op">%in%</span><span class="st"> </span>valid_fig_types]

  <span class="cf">if</span> ( <span class="kw">length</span>(invalid_fig_types) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> ) {
    <span class="kw">stop</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">The following figure types are invalid: &quot;</span>, <span class="kw">paste</span>(invalid_fig_types, <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>), <span class="st">&quot;.&quot;</span>,
         <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Valid options are: &quot;</span>, <span class="kw">paste</span>(valid_fig_types, <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>) ,<span class="st">&quot;.&quot;</span>)
  }


  <span class="co"># Make color vector</span>
  <span class="cf">if</span> ( <span class="kw">is.null</span>(col) ) {
    col &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;speciation rate&quot;</span>=<span class="st">&quot;#984EA3&quot;</span>,
             <span class="st">&quot;speciation shift times&quot;</span>=<span class="st">&quot;#984EA3&quot;</span>,
             <span class="st">&quot;speciation Bayes factors&quot;</span>=<span class="st">&quot;#984EA3&quot;</span>,
             <span class="st">&quot;extinction rate&quot;</span>=<span class="st">&quot;#E41A1C&quot;</span>,
             <span class="st">&quot;extinction shift times&quot;</span>=<span class="st">&quot;#E41A1C&quot;</span>,
             <span class="st">&quot;extinction Bayes factors&quot;</span>=<span class="st">&quot;#E41A1C&quot;</span>,
             <span class="st">&quot;fossilization rate&quot;</span>=<span class="st">&quot;#ffa31a&quot;</span>,
             <span class="st">&quot;fossilization shift times&quot;</span>=<span class="st">&quot;#ffa31a&quot;</span>,
             <span class="st">&quot;fossilization Bayes factors&quot;</span>=<span class="st">&quot;#ffa31a&quot;</span>,
             <span class="st">&quot;net-diversification rate&quot;</span>=<span class="st">&quot;#377EB8&quot;</span>,
             <span class="st">&quot;relative-extinction rate&quot;</span>=<span class="st">&quot;#FF7F00&quot;</span>,
             <span class="st">&quot;mass extinction times&quot;</span>=<span class="st">&quot;#4DAF4A&quot;</span>,
             <span class="st">&quot;mass extinction Bayes factors&quot;</span>=<span class="st">&quot;#4DAF4A&quot;</span>)
  } <span class="cf">else</span> {
    <span class="kw">names</span>(col) &lt;-<span class="st"> </span>fig_types
  }

  <span class="co"># Compute the axes</span>
  intervals &lt;-<span class="st"> </span>output<span class="op">$</span><span class="st">`</span><span class="dt">speciation time</span><span class="st">`</span>[<span class="dv">1</span>,<span class="kw">grep</span>(<span class="st">&quot;interval&quot;</span>, <span class="kw">colnames</span>(output<span class="op">$</span><span class="st">`</span><span class="dt">speciation time</span><span class="st">`</span>))]
  tree_age &lt;-<span class="st"> </span><span class="kw">max</span>(intervals)
  num_intervals &lt;-<span class="st"> </span><span class="kw">length</span>(intervals) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>
  plot_at &lt;-<span class="st"> </span><span class="dv">0</span><span class="op">:</span>num_intervals
  interval_size &lt;-<span class="st"> </span>tree_age<span class="op">/</span>num_intervals
  labels &lt;-<span class="st"> </span><span class="kw">pretty</span>( <span class="kw">c</span>(<span class="dv">0</span>,tree_age) ) <span class="op">+</span><span class="st"> </span>offset
  labels_at &lt;-<span class="st"> </span>num_intervals <span class="op">-</span><span class="st"> </span>( <span class="kw">pretty</span>(<span class="kw">c</span>(<span class="dv">0</span>,tree_age)) <span class="op">/</span><span class="st"> </span>interval_size )
  ages &lt;-<span class="st"> </span><span class="kw">seq</span>( <span class="dv">0</span>,tree_age, <span class="dt">length.out =</span> num_intervals <span class="op">+</span><span class="st"> </span><span class="dv">1</span> )

  <span class="cf">for</span>( type <span class="cf">in</span> fig_types ) {

      this_output &lt;-<span class="st"> </span>output[[type]][ ,<span class="kw">grep</span>(<span class="st">&quot;[0-9]&quot;</span>, <span class="kw">colnames</span>(output[[type]])) ]
      mean_this_output &lt;-<span class="st"> </span><span class="kw">colMeans</span>(this_output)
      quantiles_this_output &lt;-<span class="st"> </span><span class="kw">apply</span>(this_output, <span class="dv">2</span>, quantile, <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))

      <span class="co"># find the limits of the y-axis</span>
      <span class="co"># we always want the speciation and extinction rates to be on the same scale</span>
      <span class="cf">if</span> ( type <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;speciation rate&quot;</span>,<span class="st">&quot;extinction rate&quot;</span>)) {

        quantiles_speciation &lt;-
<span class="st">          </span><span class="kw">apply</span>(output[[<span class="st">&quot;speciation rate&quot;</span>]][ ,<span class="kw">grep</span>(<span class="st">&quot;[0-9]&quot;</span>, <span class="kw">colnames</span>(output[[<span class="st">&quot;speciation rate&quot;</span>]])) ],
                <span class="dv">2</span>, quantile, <span class="dt">prob=</span><span class="kw">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))
        quantiles_extinction &lt;-
<span class="st">          </span><span class="kw">apply</span>(output[[<span class="st">&quot;extinction rate&quot;</span>]][ ,<span class="kw">grep</span>(<span class="st">&quot;[0-9]&quot;</span>, <span class="kw">colnames</span>(output[[<span class="st">&quot;extinction rate&quot;</span>]])) ],
                <span class="dv">2</span>, quantile, <span class="dt">prob=</span><span class="kw">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))
        ylim &lt;-<span class="st"> </span><span class="kw">c</span>( <span class="kw">min</span>(<span class="dv">0</span>, quantiles_speciation, quantiles_extinction),
                   <span class="kw">max</span>(quantiles_speciation, quantiles_extinction) )

      } <span class="cf">else</span> {
        ylim &lt;-<span class="st"> </span><span class="kw">c</span>( <span class="kw">min</span>(<span class="dv">0</span>, quantiles_this_output),
                   <span class="kw">max</span>(quantiles_this_output) )
      }

      #### plot
        <span class="kw">plot</span>( <span class="dt">x =</span> plot_at, <span class="dt">y =</span> <span class="kw">c</span>( <span class="kw">rev</span>(mean_this_output)),
              <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">ylim =</span> ylim, <span class="dt">xaxt =</span> xaxt, <span class="dt">col =</span> col[type],
              <span class="dt">ylab =</span> <span class="st">&quot;rate&quot;</span>, <span class="dt">main =</span> type, <span class="dt">xlab =</span> xlab,...)
        <span class="kw">polygon</span>( <span class="dt">x =</span> <span class="kw">c</span>( <span class="dv">0</span><span class="op">:</span><span class="kw">ncol</span>(quantiles_this_output),
                        <span class="kw">ncol</span>(quantiles_this_output)<span class="op">:</span><span class="dv">0</span> ),
                 <span class="dt">y =</span> <span class="kw">c</span>( <span class="kw">rev</span>(<span class="kw">c</span>(quantiles_this_output[<span class="dv">1</span>,<span class="dv">1</span>],
                          quantiles_this_output[<span class="dv">1</span>,])),
                        <span class="kw">c</span>(quantiles_this_output[<span class="dv">2</span>,<span class="dv">1</span>],
                              quantiles_this_output[<span class="dv">2</span>,])),
                 <span class="dt">border =</span> <span class="ot">NA</span>, <span class="dt">col =</span> <span class="kw">paste</span>(col[type], col_alpha, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>) )
        <span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at =</span> labels_at, <span class="dt">labels =</span> labels)
      }

    }</code></pre></div>
</div>
</div>
<div id="general" class="section level2">
<h2>General</h2>
<p>Each function should be defined in an R script with the name of the function as the file name. For example the plotDivRates() function is defined in a source file called: plotDivRates.R. These files should be stored in the RevGadgets &gt; R subdirectory.</p>
</div>
<div id="package-dependencies" class="section level2">
<h2>Package Dependencies</h2>
<p>Your functions may depend on objects or functions from other packages, such as ape, ggtree, etc. Please do not load in packages within functions. All packages that RevGadgets functions depend on should be included in the Depends line of the Description file, located in the base directory.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Encoding<span class="op">:</span><span class="st"> </span>UTF<span class="op">-</span><span class="dv">8</span>
LazyData<span class="op">:</span><span class="st"> </span>true
RoxygenNote<span class="op">:</span><span class="st"> </span><span class="fl">6.1</span>.<span class="dv">0</span>
Depends<span class="op">:</span><span class="st"> </span>ape, phytools, ggtree
Suggests<span class="op">:</span><span class="st"> </span>testthat,
    knitr,
    rmarkdown</code></pre></div>
<p>By including dependency packages here, this ensures that the dependencies will be loaded when RevGadgets is loaded, and will be installed when RevGadgets are installed.</p>
</div>
<div id="document-function" class="section level2">
<h2>Document Function</h2>
<p>We will use the package roxygen2 to document functions. Function documentation should occur at the very beginning of the source file. In plotDivRates.R, this documentation appears as:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#' Plot Diversification Rates</span>
<span class="co">#'</span>
<span class="co">#' Plots the output of a episodic diversification rate analysis</span>
<span class="co">#'</span>
<span class="co">#' Plots the output of diversification rate analyses. Takes as input the</span>
<span class="co">#' output of processDivRates() and plotting parameters. Does not return an</span>
<span class="co">#' object. For now, valid figure types include: &quot;speciation rate&quot;,</span>
<span class="co">#' &quot;extinction rate&quot;,&quot;net-diversification rate&quot;, and &quot;relative-extinction rate&quot;.</span>
<span class="co">#' If colors are not provided (parameter col), the plot defaults to preset colors.</span>
<span class="co">#'</span>
<span class="co">#'</span>
<span class="co">#' @param output (list; no default) The processed output for plotting (output of processDivRates()).</span>
<span class="co">#' @param fig_types (character vector, c(&quot;speciation rate&quot;, &quot;extinction rate&quot;, &quot;net-diversification rate&quot;, &quot;relative-extinction rate&quot;)) Which aspects of the model to visualize. See details for a complete description.</span>
<span class="co">#' @param xlab (character; &quot;million years ago&quot;) The label of the x-axis.</span>
<span class="co">#' @param col (character; NULL) Colors used for printing in hex code. Must be of same length as fig_types.</span>
<span class="co">#' @param col_alpha (character; &quot;50&quot;) Alpha channel parameter for credible intervals plotting. May range from 00 (completely transparent) to FF (completely opaque).</span>
<span class="co">#' @param offset (numeric; 0) Value to offset the x-axis by.</span>
<span class="co">#' @param xaxt (character; &quot;n&quot;) The type of x-axis to plot. By default, no x-axis is plotted (recommended).</span>
<span class="co">#' @param yaxt (character; &quot;s&quot;) The type of y-axis to plot.</span>
<span class="co">#' @param ... Parameters delegated to various plotting functions.</span>
<span class="co">#'</span>
<span class="co">#' @return Plots diversification rates, does not return an object.</span>
<span class="co">#'</span>
<span class="co">#'  @examples</span>
<span class="co">#' # first run processDivRates()</span>
<span class="co">#' primates &lt;- processDivRates(speciation_time_log = &quot;data/epi_bd/primates_EBD_speciation_times.log&quot;,</span>
<span class="co">#'                             speciation_rate_log = &quot;data/epi_bd/primates_EBD_speciation_rates.log&quot;,</span>
<span class="co">#'                             extinction_time_log = &quot;data/epi_bd/primates_EBD_extinction_times.log&quot;,</span>
<span class="co">#'                             extinction_rate_log = &quot;data/epi_bd/primates_EBD_extinction_rates.log&quot;,</span>
<span class="co">#'                             burnin = 0.25)</span>
<span class="co">#' # then plot results:</span>
<span class="co">#' plotDivRates(output = primates)</span></code></pre></div>
<p>Roxygen2 documentions begins with #’ to distinguish it from other comments in the file. The first sentence becomes the function title and should be formatted as a sentence. The second paragraph is the description of the function and should briefly describe the purpose of the function. The third and any additional paragraphs correspond to the Details section of the function documention, and should provide a more comprehensive description of the function.</p>
<p>The tag <strong><span class="citation">@param</span></strong> should be used to specify all parameters of the function, including information about the necessary format, default value (if exists), and a description of its purpose and/or possible values. For example, we have defined the path parameter as:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#'@param output (list; no default) The processed output for plotting (output of processDivRates()).</span></code></pre></div>
<p>Here, the <strong><span class="citation">@param</span></strong> tag indicates that we are describing a parameter, output corresponds to the exact parameter name, (list; no default) refers to the format of the parameter input and the (lack of) a default value, and “The processed output for plotting (output of processDivRates()).” describes the parameter in text.</p>
<p>The tag <strong><span class="citation">@return</span></strong> describes the object that the function returns (in this case no value is returned, the function simply produces plots) and is included under the Value section of the documentation file.</p>
<p>Finally the tag <strong><span class="citation">@examples</span></strong> provides the user with examples of the function in use. Often, it is most useful to provide multiple examples that encompass the variety of parameters and uses.</p>
<p>For more information on proper documentation of functions, refer to the roxygen2 package information.</p>
</div>
<div id="write-function" class="section level2">
<h2>Write Function</h2>
<p>The following code defines our example function, which allows the user to plot the processed output of the episodic birth-death process tutorial.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
plotDivRates &lt;-<span class="st"> </span><span class="cf">function</span>(output,
                         <span class="dt">fig_types =</span> <span class="kw">c</span>(<span class="st">&quot;speciation rate&quot;</span>,
                                       <span class="st">&quot;extinction rate&quot;</span>,
                                       <span class="st">&quot;net-diversification rate&quot;</span>,
                                       <span class="st">&quot;relative-extinction rate&quot;</span>),
                         <span class="dt">xlab =</span> <span class="st">&quot;million years ago&quot;</span>,
                         <span class="dt">col =</span> <span class="ot">NULL</span>,
                         <span class="dt">col_alpha =</span> <span class="st">&quot;50&quot;</span>,
                         <span class="dt">offset =</span> <span class="dv">0</span>,
                         <span class="dt">xaxt =</span> <span class="st">&quot;n&quot;</span>,
                         <span class="dt">yaxt =</span> <span class="st">&quot;s&quot;</span>,
                         ...){
  <span class="co"># Enforce argument matching</span>
  <span class="cf">if</span> (<span class="kw">is.list</span>(output) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="kw">stop</span>(<span class="st">&quot;output must be list of processed rates&quot;</span>)
  <span class="cf">if</span> (<span class="kw">is.character</span>(fig_types) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="kw">stop</span>(<span class="st">&quot;fig_types must be a character string or vector of strings&quot;</span>)
  <span class="cf">if</span> (<span class="kw">is.character</span>(xlab) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="kw">stop</span>(<span class="st">&quot;xlab must be a single character string&quot;</span>)

  <span class="co"># check length of color vector and ensure colors are formatted as hex codes</span>
  <span class="cf">if</span> (<span class="kw">is.null</span>(col) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) {
    <span class="cf">if</span> (<span class="kw">length</span>(col) <span class="op">!=</span><span class="st"> </span><span class="kw">length</span>(fig_types))
      <span class="kw">stop</span>(<span class="st">&quot;col and fig_types must be of the same length&quot;</span>)
    bad_cols &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;FALSE&quot;</span>, <span class="dt">times =</span> <span class="kw">length</span>(col))
    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(col)) {
      col_split &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(col[i], <span class="dt">split =</span> <span class="st">&quot;&quot;</span>))
      <span class="cf">if</span> (<span class="kw">length</span>(col_split) <span class="op">!=</span><span class="st"> </span><span class="dv">7</span> <span class="op">|</span><span class="st"> </span>col_split[<span class="dv">1</span>] <span class="op">!=</span><span class="st"> &quot;#&quot;</span>) {
        bad_cols[i] &lt;-<span class="st"> </span><span class="ot">TRUE</span>
      }
    }
    <span class="cf">if</span> ( <span class="kw">any</span>(bad_cols <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span> ) {
      <span class="co"># print out colors that are 'bad'</span>
      <span class="kw">cat</span>( <span class="st">&quot;Some colors are not properly formatted hex codes:&quot;</span>,
           <span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>,col[bad_cols <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>]), <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
      <span class="kw">stop</span>()
    }
  }

  <span class="cf">if</span> (<span class="kw">is.character</span>(col_alpha) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="kw">stop</span>(<span class="st">&quot;col_alpha must be a character string&quot;</span>)
  <span class="cf">if</span> (<span class="kw">is.numeric</span>(offset) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="kw">stop</span>(<span class="st">&quot;offset must be a numeric value&quot;</span>)
  xaxt &lt;-<span class="st"> </span><span class="kw">match.arg</span>(xaxt, <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;n&quot;</span>, <span class="st">&quot;s&quot;</span>))
  yaxt &lt;-<span class="st"> </span><span class="kw">match.arg</span>(yaxt, <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;n&quot;</span>, <span class="st">&quot;s&quot;</span>))


  <span class="co"># Check that fig type is valid</span>
  valid_fig_types &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;speciation rate&quot;</span>,
                       <span class="st">&quot;extinction rate&quot;</span>,
                       <span class="st">&quot;net-diversification rate&quot;</span>,
                       <span class="st">&quot;relative-extinction rate&quot;</span>)

  invalid_fig_types &lt;-<span class="st"> </span>fig_types[<span class="op">!</span>fig_types <span class="op">%in%</span><span class="st"> </span>valid_fig_types]

  <span class="cf">if</span> ( <span class="kw">length</span>(invalid_fig_types) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> ) {
    <span class="kw">stop</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">The following figure types are invalid: &quot;</span>, <span class="kw">paste</span>(invalid_fig_types, <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>), <span class="st">&quot;.&quot;</span>,
         <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Valid options are: &quot;</span>, <span class="kw">paste</span>(valid_fig_types, <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>) ,<span class="st">&quot;.&quot;</span>)
  }


  <span class="co"># Make color vector</span>
  <span class="cf">if</span> ( <span class="kw">is.null</span>(col) ) {
    col &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;speciation rate&quot;</span>=<span class="st">&quot;#984EA3&quot;</span>,
             <span class="st">&quot;speciation shift times&quot;</span>=<span class="st">&quot;#984EA3&quot;</span>,
             <span class="st">&quot;speciation Bayes factors&quot;</span>=<span class="st">&quot;#984EA3&quot;</span>,
             <span class="st">&quot;extinction rate&quot;</span>=<span class="st">&quot;#E41A1C&quot;</span>,
             <span class="st">&quot;extinction shift times&quot;</span>=<span class="st">&quot;#E41A1C&quot;</span>,
             <span class="st">&quot;extinction Bayes factors&quot;</span>=<span class="st">&quot;#E41A1C&quot;</span>,
             <span class="st">&quot;fossilization rate&quot;</span>=<span class="st">&quot;#ffa31a&quot;</span>,
             <span class="st">&quot;fossilization shift times&quot;</span>=<span class="st">&quot;#ffa31a&quot;</span>,
             <span class="st">&quot;fossilization Bayes factors&quot;</span>=<span class="st">&quot;#ffa31a&quot;</span>,
             <span class="st">&quot;net-diversification rate&quot;</span>=<span class="st">&quot;#377EB8&quot;</span>,
             <span class="st">&quot;relative-extinction rate&quot;</span>=<span class="st">&quot;#FF7F00&quot;</span>,
             <span class="st">&quot;mass extinction times&quot;</span>=<span class="st">&quot;#4DAF4A&quot;</span>,
             <span class="st">&quot;mass extinction Bayes factors&quot;</span>=<span class="st">&quot;#4DAF4A&quot;</span>)
  } <span class="cf">else</span> {
    <span class="kw">names</span>(col) &lt;-<span class="st"> </span>fig_types
  }

  <span class="co"># Compute the axes</span>
  intervals &lt;-<span class="st"> </span>output<span class="op">$</span><span class="st">`</span><span class="dt">speciation time</span><span class="st">`</span>[<span class="dv">1</span>,<span class="kw">grep</span>(<span class="st">&quot;interval&quot;</span>, <span class="kw">colnames</span>(output<span class="op">$</span><span class="st">`</span><span class="dt">speciation time</span><span class="st">`</span>))]
  tree_age &lt;-<span class="st"> </span><span class="kw">max</span>(intervals)
  num_intervals &lt;-<span class="st"> </span><span class="kw">length</span>(intervals) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>
  plot_at &lt;-<span class="st"> </span><span class="dv">0</span><span class="op">:</span>num_intervals
  interval_size &lt;-<span class="st"> </span>tree_age<span class="op">/</span>num_intervals
  labels &lt;-<span class="st"> </span><span class="kw">pretty</span>( <span class="kw">c</span>(<span class="dv">0</span>,tree_age) ) <span class="op">+</span><span class="st"> </span>offset
  labels_at &lt;-<span class="st"> </span>num_intervals <span class="op">-</span><span class="st"> </span>( <span class="kw">pretty</span>(<span class="kw">c</span>(<span class="dv">0</span>,tree_age)) <span class="op">/</span><span class="st"> </span>interval_size )
  ages &lt;-<span class="st"> </span><span class="kw">seq</span>( <span class="dv">0</span>,tree_age, <span class="dt">length.out =</span> num_intervals <span class="op">+</span><span class="st"> </span><span class="dv">1</span> )

  <span class="cf">for</span>( type <span class="cf">in</span> fig_types ) {

      this_output &lt;-<span class="st"> </span>output[[type]][ ,<span class="kw">grep</span>(<span class="st">&quot;[0-9]&quot;</span>, <span class="kw">colnames</span>(output[[type]])) ]
      mean_this_output &lt;-<span class="st"> </span><span class="kw">colMeans</span>(this_output)
      quantiles_this_output &lt;-<span class="st"> </span><span class="kw">apply</span>(this_output, <span class="dv">2</span>, quantile, <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))

      <span class="co"># find the limits of the y-axis</span>
      <span class="co"># we always want the speciation and extinction rates to be on the same scale</span>
      <span class="cf">if</span> ( type <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;speciation rate&quot;</span>,<span class="st">&quot;extinction rate&quot;</span>)) {

        quantiles_speciation &lt;-
<span class="st">          </span><span class="kw">apply</span>(output[[<span class="st">&quot;speciation rate&quot;</span>]][ ,<span class="kw">grep</span>(<span class="st">&quot;[0-9]&quot;</span>, <span class="kw">colnames</span>(output[[<span class="st">&quot;speciation rate&quot;</span>]])) ],
                <span class="dv">2</span>, quantile, <span class="dt">prob=</span><span class="kw">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))
        quantiles_extinction &lt;-
<span class="st">          </span><span class="kw">apply</span>(output[[<span class="st">&quot;extinction rate&quot;</span>]][ ,<span class="kw">grep</span>(<span class="st">&quot;[0-9]&quot;</span>, <span class="kw">colnames</span>(output[[<span class="st">&quot;extinction rate&quot;</span>]])) ],
                <span class="dv">2</span>, quantile, <span class="dt">prob=</span><span class="kw">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))
        ylim &lt;-<span class="st"> </span><span class="kw">c</span>( <span class="kw">min</span>(<span class="dv">0</span>, quantiles_speciation, quantiles_extinction),
                   <span class="kw">max</span>(quantiles_speciation, quantiles_extinction) )

      } <span class="cf">else</span> {
        ylim &lt;-<span class="st"> </span><span class="kw">c</span>( <span class="kw">min</span>(<span class="dv">0</span>, quantiles_this_output),
                   <span class="kw">max</span>(quantiles_this_output) )
      }

      #### plot
        <span class="kw">plot</span>( <span class="dt">x =</span> plot_at, <span class="dt">y =</span> <span class="kw">c</span>( <span class="kw">rev</span>(mean_this_output)),
              <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">ylim =</span> ylim, <span class="dt">xaxt =</span> xaxt, <span class="dt">col =</span> col[type],
              <span class="dt">ylab =</span> <span class="st">&quot;rate&quot;</span>, <span class="dt">main =</span> type, <span class="dt">xlab =</span> xlab,...)
        <span class="kw">polygon</span>( <span class="dt">x =</span> <span class="kw">c</span>( <span class="dv">0</span><span class="op">:</span><span class="kw">ncol</span>(quantiles_this_output),
                        <span class="kw">ncol</span>(quantiles_this_output)<span class="op">:</span><span class="dv">0</span> ),
                 <span class="dt">y =</span> <span class="kw">c</span>( <span class="kw">rev</span>(<span class="kw">c</span>(quantiles_this_output[<span class="dv">1</span>,<span class="dv">1</span>],
                          quantiles_this_output[<span class="dv">1</span>,])),
                        <span class="kw">c</span>(quantiles_this_output[<span class="dv">2</span>,<span class="dv">1</span>],
                              quantiles_this_output[<span class="dv">2</span>,])),
                 <span class="dt">border =</span> <span class="ot">NA</span>, <span class="dt">col =</span> <span class="kw">paste</span>(col[type], col_alpha, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>) )
        <span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at =</span> labels_at, <span class="dt">labels =</span> labels)
      }

    }</code></pre></div>
<p>The first step in writing a function is naming the function and establishing the parameters of the function. This is done on the first few lines; in our example, the function is named plotDivRates and contains parameters output, fig_types, etc.. We include … in the list of parameters to indicate that any additional parameters the user supplies will be passed as arguments to an internal function called within our function (see below for how this is used). The use of function() tells R that we are defining a function with a name indicated by the assignment arrow, and to expect all parameter names within the parentheses. The opening curly bracket indicates that the function will be defined in the rows below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plotDivRates &lt;-<span class="st"> </span><span class="cf">function</span>(output,
                         <span class="dt">fig_types =</span> <span class="kw">c</span>(<span class="st">&quot;speciation rate&quot;</span>,
                                       <span class="st">&quot;extinction rate&quot;</span>,
                                       <span class="st">&quot;net-diversification rate&quot;</span>,
                                       <span class="st">&quot;relative-extinction rate&quot;</span>),
                         <span class="dt">xlab =</span> <span class="st">&quot;million years ago&quot;</span>,
                         <span class="dt">col =</span> <span class="ot">NULL</span>,
                         <span class="dt">col_alpha =</span> <span class="st">&quot;50&quot;</span>,
                         <span class="dt">offset =</span> <span class="dv">0</span>,
                         <span class="dt">xaxt =</span> <span class="st">&quot;n&quot;</span>,
                         <span class="dt">yaxt =</span> <span class="st">&quot;s&quot;</span>,
                         ...){</code></pre></div>
<p>We ask that you follow the style guides of RevBayes: functions should be in camel case (i.e. plotDivRates(), processDivRates()) and parameter names should be in snake case (i.e. fig_types, col_alpha). An exception may be made if the parameter will simply be passed to another function (i.e. check.names in the readTrace() function is passed to the read.table() function, and the original read.table() parameter name is preserved).</p>
<p>The tasks that the function will perform are defined within curly brackets following the function() element. Functions should include informative error messages that will catch common user mistakes, especially for correct formating of parameter values. In our example, the first task of the function is to check that the user has indicated logical parameter values. For example, we check that output is a list, fig_types is a string or vector of strings, xlab is a single character string, etc.. We also check that vector lengths match when necessary.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">  <span class="co"># Enforce argument matching</span>
  <span class="cf">if</span> (<span class="kw">is.list</span>(output) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="kw">stop</span>(<span class="st">&quot;output must be list of processed rates&quot;</span>)
  <span class="cf">if</span> (<span class="kw">is.character</span>(fig_types) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="kw">stop</span>(<span class="st">&quot;fig_types must be a character string or vector of strings&quot;</span>)
  <span class="cf">if</span> (<span class="kw">is.character</span>(xlab) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="kw">stop</span>(<span class="st">&quot;xlab must be a single character string&quot;</span>)

  <span class="co"># check length of color vector and ensure colors are formatted as hex codes</span>
  <span class="cf">if</span> (<span class="kw">is.null</span>(col) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) {
    <span class="cf">if</span> (<span class="kw">length</span>(col) <span class="op">!=</span><span class="st"> </span><span class="kw">length</span>(fig_types))
      <span class="kw">stop</span>(<span class="st">&quot;col and fig_types must be of the same length&quot;</span>)
    bad_cols &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;FALSE&quot;</span>, <span class="dt">times =</span> <span class="kw">length</span>(col))
    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(col)) {
      col_split &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">strsplit</span>(col[i], <span class="dt">split =</span> <span class="st">&quot;&quot;</span>))
      <span class="cf">if</span> (<span class="kw">length</span>(col_split) <span class="op">!=</span><span class="st"> </span><span class="dv">7</span> <span class="op">|</span><span class="st"> </span>col_split[<span class="dv">1</span>] <span class="op">!=</span><span class="st"> &quot;#&quot;</span>) {
        bad_cols[i] &lt;-<span class="st"> </span><span class="ot">TRUE</span>
      }
    }
    <span class="cf">if</span> ( <span class="kw">any</span>(bad_cols <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>) <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span> ) {
      <span class="co"># print out colors that are 'bad'</span>
      <span class="kw">cat</span>( <span class="st">&quot;Some colors are not properly formatted hex codes:&quot;</span>,
           <span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>,col[bad_cols <span class="op">==</span><span class="st"> </span><span class="ot">TRUE</span>]), <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)
      <span class="kw">stop</span>()
    }
  }

  <span class="cf">if</span> (<span class="kw">is.character</span>(col_alpha) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="kw">stop</span>(<span class="st">&quot;col_alpha must be a character string&quot;</span>)
  <span class="cf">if</span> (<span class="kw">is.numeric</span>(offset) <span class="op">==</span><span class="st"> </span><span class="ot">FALSE</span>) <span class="kw">stop</span>(<span class="st">&quot;offset must be a numeric value&quot;</span>)
  xaxt &lt;-<span class="st"> </span><span class="kw">match.arg</span>(xaxt, <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;n&quot;</span>, <span class="st">&quot;s&quot;</span>))
  yaxt &lt;-<span class="st"> </span><span class="kw">match.arg</span>(yaxt, <span class="dt">choices =</span> <span class="kw">c</span>(<span class="st">&quot;n&quot;</span>, <span class="st">&quot;s&quot;</span>))


  <span class="co"># Check that fig type is valid</span>
  valid_fig_types &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;speciation rate&quot;</span>,
                       <span class="st">&quot;extinction rate&quot;</span>,
                       <span class="st">&quot;net-diversification rate&quot;</span>,
                       <span class="st">&quot;relative-extinction rate&quot;</span>)

  invalid_fig_types &lt;-<span class="st"> </span>fig_types[<span class="op">!</span>fig_types <span class="op">%in%</span><span class="st"> </span>valid_fig_types]

  <span class="cf">if</span> ( <span class="kw">length</span>(invalid_fig_types) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span> ) {
    <span class="kw">stop</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">The following figure types are invalid: &quot;</span>, <span class="kw">paste</span>(invalid_fig_types, <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>), <span class="st">&quot;.&quot;</span>,
         <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Valid options are: &quot;</span>, <span class="kw">paste</span>(valid_fig_types, <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>) ,<span class="st">&quot;.&quot;</span>)
  }</code></pre></div>
<p>The stop command is used to provide informative error messages if these checks are false. match.arg() ensures that the parameter value is one of only a few designed options. If the user inputs a value that is not included in the choices for match.arg(), the function will stop and inform the user that values must be either of the options (“n” or “s” for xaxt and yaxt in this example). This works well for single values, but if the user may supply any number of potential options in a vector, we check that the supplied values fall within our predetermined possible values (in fig_type, for example, only four options are currently permitted).</p>
<p>Next, the function performs its task, in our case producing plots from processed log files. We have designed the function to accept user provided colors as hex codes, but if the user does not specify colors for the plots, we assign them at the beginning. Next, we compute our axes for the plots based on the processed rates and assign labels to the x axes. Finally, we loop through each desired plot type, calculating means and quantiles from the posteriors and plotting the results.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># read in tree(s) of type nexus or newick</span>

<span class="co"># Make color vector</span>
  <span class="cf">if</span> ( <span class="kw">is.null</span>(col) ) {
    col &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;speciation rate&quot;</span>=<span class="st">&quot;#984EA3&quot;</span>,
             <span class="st">&quot;speciation shift times&quot;</span>=<span class="st">&quot;#984EA3&quot;</span>,
             <span class="st">&quot;speciation Bayes factors&quot;</span>=<span class="st">&quot;#984EA3&quot;</span>,
             <span class="st">&quot;extinction rate&quot;</span>=<span class="st">&quot;#E41A1C&quot;</span>,
             <span class="st">&quot;extinction shift times&quot;</span>=<span class="st">&quot;#E41A1C&quot;</span>,
             <span class="st">&quot;extinction Bayes factors&quot;</span>=<span class="st">&quot;#E41A1C&quot;</span>,
             <span class="st">&quot;fossilization rate&quot;</span>=<span class="st">&quot;#ffa31a&quot;</span>,
             <span class="st">&quot;fossilization shift times&quot;</span>=<span class="st">&quot;#ffa31a&quot;</span>,
             <span class="st">&quot;fossilization Bayes factors&quot;</span>=<span class="st">&quot;#ffa31a&quot;</span>,
             <span class="st">&quot;net-diversification rate&quot;</span>=<span class="st">&quot;#377EB8&quot;</span>,
             <span class="st">&quot;relative-extinction rate&quot;</span>=<span class="st">&quot;#FF7F00&quot;</span>,
             <span class="st">&quot;mass extinction times&quot;</span>=<span class="st">&quot;#4DAF4A&quot;</span>,
             <span class="st">&quot;mass extinction Bayes factors&quot;</span>=<span class="st">&quot;#4DAF4A&quot;</span>)
  } <span class="cf">else</span> {
    <span class="kw">names</span>(col) &lt;-<span class="st"> </span>fig_types
  }

  <span class="co"># Compute the axes</span>
  intervals &lt;-<span class="st"> </span>output<span class="op">$</span><span class="st">`</span><span class="dt">speciation time</span><span class="st">`</span>[<span class="dv">1</span>,<span class="kw">grep</span>(<span class="st">&quot;interval&quot;</span>, <span class="kw">colnames</span>(output<span class="op">$</span><span class="st">`</span><span class="dt">speciation time</span><span class="st">`</span>))]
  tree_age &lt;-<span class="st"> </span><span class="kw">max</span>(intervals)
  num_intervals &lt;-<span class="st"> </span><span class="kw">length</span>(intervals) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>
  plot_at &lt;-<span class="st"> </span><span class="dv">0</span><span class="op">:</span>num_intervals
  interval_size &lt;-<span class="st"> </span>tree_age<span class="op">/</span>num_intervals
  labels &lt;-<span class="st"> </span><span class="kw">pretty</span>( <span class="kw">c</span>(<span class="dv">0</span>,tree_age) ) <span class="op">+</span><span class="st"> </span>offset
  labels_at &lt;-<span class="st"> </span>num_intervals <span class="op">-</span><span class="st"> </span>( <span class="kw">pretty</span>(<span class="kw">c</span>(<span class="dv">0</span>,tree_age)) <span class="op">/</span><span class="st"> </span>interval_size )
  ages &lt;-<span class="st"> </span><span class="kw">seq</span>( <span class="dv">0</span>,tree_age, <span class="dt">length.out =</span> num_intervals <span class="op">+</span><span class="st"> </span><span class="dv">1</span> )

  <span class="cf">for</span>( type <span class="cf">in</span> fig_types ) {

      this_output &lt;-<span class="st"> </span>output[[type]][ ,<span class="kw">grep</span>(<span class="st">&quot;[0-9]&quot;</span>, <span class="kw">colnames</span>(output[[type]])) ]
      mean_this_output &lt;-<span class="st"> </span><span class="kw">colMeans</span>(this_output)
      quantiles_this_output &lt;-<span class="st"> </span><span class="kw">apply</span>(this_output, <span class="dv">2</span>, quantile, <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))

      <span class="co"># find the limits of the y-axis</span>
      <span class="co"># we always want the speciation and extinction rates to be on the same scale</span>
      <span class="cf">if</span> ( type <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;speciation rate&quot;</span>,<span class="st">&quot;extinction rate&quot;</span>)) {

        quantiles_speciation &lt;-
<span class="st">          </span><span class="kw">apply</span>(output[[<span class="st">&quot;speciation rate&quot;</span>]][ ,<span class="kw">grep</span>(<span class="st">&quot;[0-9]&quot;</span>, <span class="kw">colnames</span>(output[[<span class="st">&quot;speciation rate&quot;</span>]])) ],
                <span class="dv">2</span>, quantile, <span class="dt">prob=</span><span class="kw">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))
        quantiles_extinction &lt;-
<span class="st">          </span><span class="kw">apply</span>(output[[<span class="st">&quot;extinction rate&quot;</span>]][ ,<span class="kw">grep</span>(<span class="st">&quot;[0-9]&quot;</span>, <span class="kw">colnames</span>(output[[<span class="st">&quot;extinction rate&quot;</span>]])) ],
                <span class="dv">2</span>, quantile, <span class="dt">prob=</span><span class="kw">c</span>(<span class="fl">0.025</span>,<span class="fl">0.975</span>))
        ylim &lt;-<span class="st"> </span><span class="kw">c</span>( <span class="kw">min</span>(<span class="dv">0</span>, quantiles_speciation, quantiles_extinction),
                   <span class="kw">max</span>(quantiles_speciation, quantiles_extinction) )

      } <span class="cf">else</span> {
        ylim &lt;-<span class="st"> </span><span class="kw">c</span>( <span class="kw">min</span>(<span class="dv">0</span>, quantiles_this_output),
                   <span class="kw">max</span>(quantiles_this_output) )
      }

      #### plot
        <span class="kw">plot</span>( <span class="dt">x =</span> plot_at, <span class="dt">y =</span> <span class="kw">c</span>( <span class="kw">rev</span>(mean_this_output)),
              <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">ylim =</span> ylim, <span class="dt">xaxt =</span> xaxt, <span class="dt">col =</span> col[type],
              <span class="dt">ylab =</span> <span class="st">&quot;rate&quot;</span>, <span class="dt">main =</span> type, <span class="dt">xlab =</span> xlab,...)
        <span class="kw">polygon</span>( <span class="dt">x =</span> <span class="kw">c</span>( <span class="dv">0</span><span class="op">:</span><span class="kw">ncol</span>(quantiles_this_output),
                        <span class="kw">ncol</span>(quantiles_this_output)<span class="op">:</span><span class="dv">0</span> ),
                 <span class="dt">y =</span> <span class="kw">c</span>( <span class="kw">rev</span>(<span class="kw">c</span>(quantiles_this_output[<span class="dv">1</span>,<span class="dv">1</span>],
                          quantiles_this_output[<span class="dv">1</span>,])),
                        <span class="kw">c</span>(quantiles_this_output[<span class="dv">2</span>,<span class="dv">1</span>],
                              quantiles_this_output[<span class="dv">2</span>,])),
                 <span class="dt">border =</span> <span class="ot">NA</span>, <span class="dt">col =</span> <span class="kw">paste</span>(col[type], col_alpha, <span class="dt">sep=</span><span class="st">&quot;&quot;</span>) )
        <span class="kw">axis</span>(<span class="dv">1</span>, <span class="dt">at =</span> labels_at, <span class="dt">labels =</span> labels)
      }
<span class="er">}</span></code></pre></div>
<p>In many cases, you may want the function to produce an object (data frame, value, etc.) that will be outputted to the user. In plotDivRates(), we do not do this; the function simply plots the provided data, and the final curly bracket ends the function. However, in processDivRates(), we wish to return a list of the process rates. We create a list of the processed rates, and then use return() to indicate that the function should produce this for the user.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
 <span class="co"># return a list of processed data frames</span>
 res &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;speciation rate&quot;</span> =<span class="st"> </span>speciation_rate,
             <span class="st">&quot;extinction rate&quot;</span> =<span class="st"> </span>extinction_rate,
             <span class="st">&quot;net-diversification rate&quot;</span> =<span class="st"> </span>net_diversification_rate,
             <span class="st">&quot;relative-extinction rate&quot;</span> =<span class="st"> </span>relative_extinction_rate,
             <span class="st">&quot;speciation time&quot;</span> =<span class="st"> </span>speciation_time,
             <span class="st">&quot;extinction time&quot;</span> =<span class="st"> </span>extinction_time)
 <span class="kw">return</span>(res)</code></pre></div>
</div>
<div id="test-function" class="section level2">
<h2>Test Function</h2>
<p>Finally, we ask that you additionally include a separate file that can be used to test the function using testthat. These files should be stored in the RevGadgets &gt; tests &gt; testthat subdirectory. For the processDivRates() function, we have created a testing file called test_processDivRates.R, the contents of which are shown below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">context</span>(<span class="st">&quot;tests the processDivRates function&quot;</span>)

<span class="co"># relies heavily on readTrace(), so we only test for elements not</span>
<span class="co"># included in the readTrace() testing.</span>

<span class="kw">test_that</span>(<span class="st">&quot;processes birth-death scripts&quot;</span>, {
  primates &lt;-<span class="st"> </span><span class="kw">processDivRates</span>(<span class="dt">speciation_time_log =</span> <span class="st">&quot;../../data/epi_bd/primates_EBD_speciation_times.log&quot;</span>,
                              <span class="dt">speciation_rate_log =</span> <span class="st">&quot;../../data/epi_bd/primates_EBD_speciation_rates.log&quot;</span>,
                              <span class="dt">extinction_time_log =</span> <span class="st">&quot;../../data/epi_bd/primates_EBD_extinction_times.log&quot;</span>,
                              <span class="dt">extinction_rate_log =</span> <span class="st">&quot;../../data/epi_bd/primates_EBD_extinction_rates.log&quot;</span>,
                              <span class="dt">burnin =</span> <span class="fl">0.25</span>)
  <span class="kw">expect_equal</span>(<span class="kw">length</span>(primates), <span class="dv">6</span>)
  <span class="kw">expect_equal</span>(<span class="kw">class</span>(primates), <span class="st">&quot;list&quot;</span>)
  <span class="kw">expect_equal</span>(<span class="kw">nrow</span>(primates[[<span class="dv">1</span>]]), <span class="dv">3750</span>)
})</code></pre></div>
<p>Each function should have an associated testing script that tests various functionalities. As the creator of the function, it is up to you to choose which types of tests will be most informative in catching potential errors. We recommend erring on the side of including tests that seem redundant or unnecessary, because changes in dependency packages, or other unexpected events, can cause errors that you may not expect. We also recommend that if you ever find a bug in your code, you design a test to catch the bug if it were to ever happen again.</p>
<p>The test_that() function defines a test that checks that the outcome of your function matches what you expect. In this example, we define one test for reading in a set of four log files.</p>
<p>This test reads in the log files and then checks three aspects of the function:</p>
<ol style="list-style-type: decimal">
<li>The result contains 6 elements</li>
<li>The class of the resulting object is of type list</li>
<li>There are the expected number of rows (generations) in the processed data frames</li>
</ol>
<p>In many cases, our tests will rely on reading in sample datasets. The outputs of many RevBayes tutorials are saved in the data folder of the RevGadgets directory. Please use these standard files for testing and examples.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
